<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VIC Simulator</title>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=IBM+Plex+Sans:wght@400;500;600;700&family=IBM+Plex+Sans+Hebrew:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg-primary: #0a0e17;
  --bg-secondary: #111827;
  --bg-tertiary: #1a2332;
  --bg-cell: #0d1520;
  --border: #1e3a5f;
  --border-light: #2a4a6f;
  --accent: #00d4ff;
  --accent-dim: #0088aa;
  --accent-glow: rgba(0, 212, 255, 0.15);
  --green: #00ff88;
  --green-dim: #00aa5c;
  --yellow: #ffd700;
  --red: #ff4757;
  --orange: #ff8c42;
  --text: #e0e8f0;
  --text-dim: #7a8da0;
  --text-muted: #4a5a6a;
  --highlight-bg: rgba(0, 212, 255, 0.08);
  --pc-highlight: rgba(0, 255, 136, 0.12);
  --changed-highlight: rgba(255, 215, 0, 0.15);
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  font-family: 'IBM Plex Sans', 'IBM Plex Sans Hebrew', sans-serif;
  background: var(--bg-primary);
  color: var(--text);
  height: 100vh;
  overflow: hidden;
}

/* â”€â”€ Layout â”€â”€ */
.app-layout {
  display: grid;
  grid-template-columns: 1fr 320px;
  height: 100vh;
}

.main-area {
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

/* â”€â”€ Header â”€â”€ */
.header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 10px 20px;
  background: var(--bg-secondary);
  border-bottom: 1px solid var(--border);
}

.header-title {
  display: flex;
  align-items: center;
  gap: 10px;
}

.header-title h1 {
  font-family: 'JetBrains Mono', monospace;
  font-size: 18px;
  font-weight: 700;
  color: var(--accent);
  letter-spacing: 2px;
}

.header-title .subtitle {
  font-size: 11px;
  color: var(--text-dim);
  letter-spacing: 1px;
}

.logo-icon {
  width: 28px; height: 28px;
  border: 2px solid var(--accent);
  border-radius: 4px;
  display: flex; align-items: center; justify-content: center;
  font-family: 'JetBrains Mono', monospace;
  font-weight: 700; font-size: 13px;
  color: var(--accent);
}

/* â”€â”€ Controls Bar â”€â”€ */
.controls-bar {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 20px;
  background: var(--bg-tertiary);
  border-bottom: 1px solid var(--border);
  flex-wrap: wrap;
}

.btn {
  font-family: 'JetBrains Mono', monospace;
  font-size: 12px;
  font-weight: 600;
  padding: 6px 14px;
  border: 1px solid var(--border-light);
  border-radius: 4px;
  background: var(--bg-secondary);
  color: var(--text);
  cursor: pointer;
  transition: all 0.15s;
  display: flex; align-items: center; gap: 5px;
}

.btn:hover { border-color: var(--accent); color: var(--accent); }
.btn:active { transform: scale(0.97); }

.btn-primary {
  background: var(--accent-dim);
  border-color: var(--accent);
  color: #fff;
}
.btn-primary:hover { background: var(--accent); color: var(--bg-primary); }

.btn-danger { border-color: var(--red); color: var(--red); }
.btn-danger:hover { background: var(--red); color: #fff; }

.btn-green { border-color: var(--green-dim); color: var(--green); }
.btn-green:hover { background: var(--green-dim); color: #fff; }

.speed-control {
  display: flex; align-items: center; gap: 6px;
  margin-left: auto;
  font-size: 11px; color: var(--text-dim);
  font-family: 'JetBrains Mono', monospace;
}

.speed-control input[type="range"] {
  width: 80px;
  accent-color: var(--accent);
}

.status-indicator {
  font-family: 'JetBrains Mono', monospace;
  font-size: 11px;
  padding: 4px 10px;
  border-radius: 3px;
  background: var(--bg-cell);
  border: 1px solid var(--border);
}

.status-ready { color: var(--green); border-color: var(--green-dim); }
.status-running { color: var(--yellow); border-color: var(--yellow); }
.status-halted { color: var(--red); border-color: var(--red); }
.status-input { color: var(--orange); border-color: var(--orange); }

/* â”€â”€ Main Content Grid â”€â”€ */
.content-grid {
  display: grid;
  grid-template-columns: 320px 1fr;
  flex: 1;
  overflow: hidden;
}

/* â”€â”€ Left Panel: Editor + I/O â”€â”€ */
.left-panel {
  display: flex;
  flex-direction: column;
  border-right: 1px solid var(--border);
  overflow: hidden;
}

.panel-header {
  font-family: 'JetBrains Mono', monospace;
  font-size: 11px;
  font-weight: 600;
  letter-spacing: 1.5px;
  color: var(--text-dim);
  padding: 8px 12px;
  background: var(--bg-secondary);
  border-bottom: 1px solid var(--border);
  display: flex; align-items: center; justify-content: space-between;
}

.editor-section {
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

#code-editor {
  flex: 1;
  width: 100%;
  background: var(--bg-cell);
  color: var(--green);
  border: none;
  padding: 10px 12px;
  font-family: 'JetBrains Mono', monospace;
  font-size: 13px;
  line-height: 1.6;
  resize: none;
  outline: none;
  tab-size: 4;
}

#code-editor::placeholder { color: var(--text-muted); }

.io-section {
  border-top: 1px solid var(--border);
}

.io-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
}

.io-box {
  padding: 6px 10px;
  border-right: 1px solid var(--border);
}

.io-box:last-child { border-right: none; }

.io-box label {
  display: block;
  font-family: 'JetBrains Mono', monospace;
  font-size: 10px;
  color: var(--text-dim);
  margin-bottom: 4px;
  letter-spacing: 1px;
}

.io-box input, .io-box .output-display {
  width: 100%;
  background: var(--bg-cell);
  color: var(--accent);
  border: 1px solid var(--border);
  border-radius: 3px;
  padding: 6px 8px;
  font-family: 'JetBrains Mono', monospace;
  font-size: 13px;
  outline: none;
}

.io-box input:focus { border-color: var(--accent); }

.output-display {
  min-height: 32px;
  display: flex;
  align-items: center;
  flex-wrap: wrap;
  gap: 4px;
}

.output-val {
  background: var(--accent-glow);
  border: 1px solid var(--accent-dim);
  padding: 2px 8px;
  border-radius: 3px;
  font-size: 13px;
  color: var(--accent);
}

/* Input prompt overlay */
.input-prompt {
  display: none;
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(0,0,0,0.6);
  z-index: 100;
  align-items: center; justify-content: center;
}

.input-prompt.active { display: flex; }

.input-prompt-box {
  background: var(--bg-secondary);
  border: 2px solid var(--orange);
  border-radius: 8px;
  padding: 24px;
  text-align: center;
  box-shadow: 0 0 40px rgba(255, 140, 66, 0.2);
}

.input-prompt-box h3 {
  color: var(--orange);
  font-family: 'JetBrains Mono', monospace;
  margin-bottom: 12px;
}

.input-prompt-box input {
  background: var(--bg-cell);
  border: 1px solid var(--orange);
  color: var(--text);
  padding: 8px 16px;
  font-family: 'JetBrains Mono', monospace;
  font-size: 16px;
  border-radius: 4px;
  outline: none;
  width: 150px;
  text-align: center;
}

.input-prompt-box button {
  margin-left: 8px;
  padding: 8px 16px;
  background: var(--orange);
  color: #fff;
  border: none;
  border-radius: 4px;
  font-family: 'JetBrains Mono', monospace;
  font-weight: 600;
  cursor: pointer;
}

/* â”€â”€ Right Panel: CPU + Memory â”€â”€ */
.right-panel {
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

/* CPU Section */
.cpu-section {
  padding: 12px;
  background: var(--bg-secondary);
  border-bottom: 1px solid var(--border);
}

.cpu-registers {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 8px;
}

.register-box {
  background: var(--bg-cell);
  border: 1px solid var(--border);
  border-radius: 4px;
  padding: 8px;
  text-align: center;
}

.register-box .reg-label {
  font-family: 'JetBrains Mono', monospace;
  font-size: 9px;
  color: var(--text-dim);
  letter-spacing: 1.5px;
  margin-bottom: 4px;
}

.register-box .reg-value {
  font-family: 'JetBrains Mono', monospace;
  font-size: 20px;
  font-weight: 700;
  color: var(--yellow);
  min-height: 28px;
}

.register-box .reg-decoded {
  font-family: 'JetBrains Mono', monospace;
  font-size: 9px;
  color: var(--text-muted);
  margin-top: 2px;
  min-height: 14px;
}

/* Memory Section */
.memory-section {
  flex: 1;
  overflow: hidden;
  display: flex;
  flex-direction: column;
}

.memory-grid-container {
  flex: 1;
  overflow-y: auto;
  padding: 6px;
}

.memory-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 2px;
}

.mem-cell {
  display: flex;
  align-items: center;
  background: var(--bg-cell);
  border: 1px solid transparent;
  border-radius: 2px;
  padding: 2px 4px;
  font-family: 'JetBrains Mono', monospace;
  font-size: 11px;
  cursor: pointer;
  transition: all 0.1s;
  gap: 3px;
}

.mem-cell:hover { border-color: var(--border-light); }

.mem-addr {
  color: var(--text-muted);
  font-size: 9px;
  min-width: 18px;
}

.mem-val {
  color: var(--text);
  font-weight: 500;
  flex: 1;
  text-align: right;
}

.mem-cell.is-pc {
  background: var(--pc-highlight);
  border-color: var(--green-dim);
}

.mem-cell.is-pc .mem-val { color: var(--green); font-weight: 700; }

.mem-cell.is-changed {
  background: var(--changed-highlight);
  border-color: rgba(255, 215, 0, 0.3);
}

.mem-cell.has-instruction .mem-val { color: var(--accent); }
.mem-cell.is-data .mem-val { color: var(--orange); }

.mem-cell.is-zero .mem-val,
.mem-cell.is-one .mem-val { color: var(--yellow); }

/* â”€â”€ Sidebar: Questions â”€â”€ */
.sidebar {
  background: var(--bg-secondary);
  border-left: 1px solid var(--border);
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

.sidebar-header {
  padding: 12px 16px;
  background: var(--bg-tertiary);
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.sidebar-header h2 {
  font-family: 'JetBrains Mono', monospace;
  font-size: 13px;
  font-weight: 600;
  color: var(--accent);
  letter-spacing: 1px;
}

.sidebar-content {
  flex: 1;
  overflow-y: auto;
  padding: 12px;
}

.question-card {
  background: var(--bg-tertiary);
  border: 1px solid var(--border);
  border-radius: 6px;
  padding: 14px;
  margin-bottom: 10px;
  transition: border-color 0.2s;
}

.question-card:hover { border-color: var(--border-light); }

.question-card.correct { border-color: var(--green-dim); background: rgba(0,255,136,0.03); }
.question-card.incorrect { border-color: var(--red); background: rgba(255,71,87,0.03); }

.q-number {
  font-family: 'JetBrains Mono', monospace;
  font-size: 10px;
  color: var(--accent-dim);
  letter-spacing: 1px;
  margin-bottom: 6px;
}

.q-text {
  font-size: 13px;
  line-height: 1.5;
  color: var(--text);
  margin-bottom: 10px;
}

.q-text code {
  background: var(--bg-cell);
  padding: 1px 5px;
  border-radius: 3px;
  font-family: 'JetBrains Mono', monospace;
  font-size: 12px;
  color: var(--accent);
}

.q-text pre {
  background: var(--bg-cell);
  padding: 8px;
  border-radius: 4px;
  margin: 6px 0;
  font-family: 'JetBrains Mono', monospace;
  font-size: 11px;
  line-height: 1.5;
  color: var(--green);
  overflow-x: auto;
}

.q-options { display: flex; flex-direction: column; gap: 4px; }

.q-option {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 6px 10px;
  background: var(--bg-cell);
  border: 1px solid var(--border);
  border-radius: 4px;
  cursor: pointer;
  font-size: 12px;
  transition: all 0.15s;
  font-family: 'JetBrains Mono', monospace;
}

.q-option:hover { border-color: var(--accent-dim); }
.q-option.selected { border-color: var(--accent); background: var(--accent-glow); }
.q-option.correct-answer { border-color: var(--green); background: rgba(0,255,136,0.08); color: var(--green); }
.q-option.wrong-answer { border-color: var(--red); background: rgba(255,71,87,0.08); color: var(--red); }

.q-input-answer {
  width: 100%;
  background: var(--bg-cell);
  border: 1px solid var(--border);
  color: var(--text);
  padding: 6px 10px;
  font-family: 'JetBrains Mono', monospace;
  font-size: 12px;
  border-radius: 4px;
  outline: none;
}

.q-input-answer:focus { border-color: var(--accent); }

.q-check-btn {
  margin-top: 8px;
  width: 100%;
  padding: 6px;
  background: var(--accent-dim);
  color: #fff;
  border: none;
  border-radius: 4px;
  font-family: 'JetBrains Mono', monospace;
  font-size: 11px;
  font-weight: 600;
  cursor: pointer;
}

.q-check-btn:hover { background: var(--accent); color: var(--bg-primary); }

.q-feedback {
  margin-top: 8px;
  padding: 8px;
  border-radius: 4px;
  font-size: 12px;
  line-height: 1.4;
  display: none;
}

.q-feedback.show { display: block; }
.q-feedback.correct { background: rgba(0,255,136,0.08); color: var(--green); border: 1px solid var(--green-dim); }
.q-feedback.incorrect { background: rgba(255,71,87,0.08); color: var(--red); border: 1px solid rgba(255,71,87,0.3); }

.score-display {
  font-family: 'JetBrains Mono', monospace;
  font-size: 12px;
  color: var(--yellow);
}

.no-questions {
  text-align: center;
  padding: 40px 20px;
  color: var(--text-muted);
  font-size: 13px;
  line-height: 1.6;
}

.no-questions .icon { font-size: 32px; margin-bottom: 12px; }

.tab-bar {
  display: flex;
  border-bottom: 1px solid var(--border);
}

.tab-btn {
  flex: 1;
  padding: 8px;
  background: var(--bg-secondary);
  border: none;
  border-bottom: 2px solid transparent;
  color: var(--text-dim);
  font-family: 'JetBrains Mono', monospace;
  font-size: 11px;
  cursor: pointer;
  transition: all 0.15s;
}

.tab-btn.active { color: var(--accent); border-bottom-color: var(--accent); }
.tab-btn:hover { color: var(--text); }

/* Tooltip for memory cells */
.mem-tooltip {
  display: none;
  position: fixed;
  background: var(--bg-tertiary);
  border: 1px solid var(--accent-dim);
  border-radius: 4px;
  padding: 6px 10px;
  font-family: 'JetBrains Mono', monospace;
  font-size: 11px;
  color: var(--text);
  z-index: 50;
  pointer-events: none;
  box-shadow: 0 4px 12px rgba(0,0,0,0.4);
}

/* Error display */
.error-bar {
  display: none;
  padding: 6px 20px;
  background: rgba(255,71,87,0.1);
  border-bottom: 1px solid var(--red);
  color: var(--red);
  font-family: 'JetBrains Mono', monospace;
  font-size: 12px;
}

.error-bar.show { display: block; }

/* Scrollbar */
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: var(--bg-primary); }
::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
::-webkit-scrollbar-thumb:hover { background: var(--border-light); }

/* Load example dropdown */
.examples-dropdown {
  position: relative;
}

.examples-menu {
  display: none;
  position: absolute;
  top: 100%;
  left: 0;
  background: var(--bg-secondary);
  border: 1px solid var(--border-light);
  border-radius: 4px;
  z-index: 20;
  min-width: 200px;
  box-shadow: 0 8px 24px rgba(0,0,0,0.4);
}

.examples-menu.show { display: block; }

.examples-menu button {
  display: block;
  width: 100%;
  text-align: left;
  padding: 8px 14px;
  background: none;
  border: none;
  color: var(--text);
  font-family: 'JetBrains Mono', monospace;
  font-size: 12px;
  cursor: pointer;
}

.examples-menu button:hover { background: var(--accent-glow); color: var(--accent); }

/* Responsive */
@media (max-width: 1100px) {
  .app-layout { grid-template-columns: 1fr; }
  .sidebar { display: none; }
}
</style>
</head>
<body>

<div class="app-layout">
  <div class="main-area">
    <!-- Header -->
    <div class="header">
      <div class="header-title">
        <div class="logo-icon">V</div>
        <div>
          <h1>VIC SIMULATOR</h1>
          <div class="subtitle">THE VISUAL COMPUTER</div>
        </div>
      </div>
    </div>

    <!-- Controls -->
    <div class="controls-bar">
      <button class="btn btn-primary" onclick="assembleAndLoad()" title="Assemble & Load (Ctrl+Enter)">â–¶ ASSEMBLE</button>
      <button class="btn btn-green" onclick="stepExecution()" id="btn-step" title="Step (F10)">â­ STEP</button>
      <button class="btn btn-green" onclick="runExecution()" id="btn-run" title="Run (F5)">â© RUN</button>
      <button class="btn" onclick="pauseExecution()" id="btn-pause">â¸ PAUSE</button>
      <button class="btn btn-danger" onclick="resetSimulator()">âŸ² RESET</button>

      <div class="examples-dropdown">
        <button class="btn" onclick="toggleExamples()">ğŸ“‚ EXAMPLES</button>
        <div class="examples-menu" id="examples-menu">
          <button onclick="loadExample('modulo')">Modulo (a % b)</button>
          <button onclick="loadExample('multiply')">Multiply (a Ã— b)</button>
          <button onclick="loadExample('abs')">Absolute Value</button>
          <button onclick="loadExample('max')">Max of Two</button>
          <button onclick="loadExample('countdown')">Countdown</button>
          <button onclick="loadExample('sum')">Sum Until Zero</button>
          <button onclick="loadExample('divide')">Integer Division</button>
          <button onclick="loadExample('fibonacci')">Fibonacci</button>
        </div>
      </div>

      <div class="speed-control">
        <span>SPEED</span>
        <input type="range" min="1" max="100" value="50" id="speed-slider">
        <span id="speed-label">50ms</span>
      </div>

      <div class="status-indicator status-ready" id="status-display">READY</div>
    </div>

    <!-- Error bar -->
    <div class="error-bar" id="error-bar"></div>

    <!-- Content -->
    <div class="content-grid">
      <!-- Left Panel: Editor + I/O -->
      <div class="left-panel">
        <div class="tab-bar">
          <button class="tab-btn active" onclick="switchTab('assembly')" id="tab-assembly">ASSEMBLY</button>
          <button class="tab-btn" onclick="switchTab('machine')" id="tab-machine">MACHINE CODE</button>
        </div>
        <div class="editor-section">
          <textarea id="code-editor" spellcheck="false" placeholder="// Write VIC assembly here
// Example:
read
gotop POSITIVE
load zero
store v
stop
POSITIVE:
  load one
  store v
  stop"></textarea>
        </div>
        <div class="io-section">
          <div class="io-grid">
            <div class="io-box">
              <label>INPUT (comma separated)</label>
              <input type="text" id="input-field" placeholder="e.g. 15, 4">
            </div>
            <div class="io-box">
              <label>OUTPUT</label>
              <div class="output-display" id="output-display"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Right Panel: CPU + Memory -->
      <div class="right-panel">
        <div class="cpu-section">
          <div class="panel-header" style="padding: 0 0 8px 0; background: none;">CPU REGISTERS</div>
          <div class="cpu-registers">
            <div class="register-box">
              <div class="reg-label">PROGRAM COUNTER</div>
              <div class="reg-value" id="reg-pc">00</div>
              <div class="reg-decoded">next instruction</div>
            </div>
            <div class="register-box">
              <div class="reg-label">INSTRUCTION REG</div>
              <div class="reg-value" id="reg-ir">---</div>
              <div class="reg-decoded" id="ir-decoded">&nbsp;</div>
            </div>
            <div class="register-box">
              <div class="reg-label">DATA REGISTER</div>
              <div class="reg-value" id="reg-dr">0</div>
              <div class="reg-decoded">accumulator</div>
            </div>
          </div>
        </div>

        <div class="memory-section">
          <div class="panel-header">
            MEMORY (00-99)
            <span style="font-size:10px; color:var(--text-muted)">98=zero 99=one</span>
          </div>
          <div class="memory-grid-container">
            <div class="memory-grid" id="memory-grid"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Sidebar: Questions -->
  <div class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <h2>ğŸ“ QUESTIONS</h2>
      <div class="score-display" id="score-display"></div>
    </div>
    <div class="sidebar-content" id="questions-container">
      <div class="no-questions">
        <div class="icon">ğŸ“‹</div>
        <div>No questions loaded yet.<br><br>
        <span style="color:var(--text-dim); font-size:12px;">
          Questions will appear here once loaded. You can add them via the <code style="color:var(--accent)">loadQuestions()</code> function or upload them.
        </span>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Input Prompt Modal -->
<div class="input-prompt" id="input-prompt">
  <div class="input-prompt-box">
    <h3>âŒ¨ INPUT REQUIRED</h3>
    <p style="color:var(--text-dim); font-size:13px; margin-bottom:12px;">The program is waiting for input (read command)</p>
    <input type="number" id="runtime-input" autofocus>
    <button onclick="submitRuntimeInput()">ENTER</button>
  </div>
</div>

<!-- Tooltip -->
<div class="mem-tooltip" id="mem-tooltip"></div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// VIC SIMULATOR ENGINE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const OPCODES = {
  'read': 1, 'write': 2, 'load': 3, 'store': 4,
  'add': 5, 'sub': 6, 'goto': 7, 'gotoz': 8,
  'gotop': 9, 'stop': 0
};

const OPCODE_NAMES = {
  1: 'read', 2: 'write', 3: 'load', 4: 'store',
  5: 'add', 6: 'sub', 7: 'goto', 8: 'gotoz',
  9: 'gotop', 0: 'stop'
};

const NO_OPERAND = new Set(['read', 'write', 'stop']);

// â”€â”€ State â”€â”€
let memory = new Array(100).fill(0);
let prevMemory = new Array(100).fill(0);
let pc = 0;
let ir = null;
let dr = 0;
let inputQueue = [];
let outputValues = [];
let running = false;
let halted = false;
let waitingForInput = false;
let runInterval = null;
let programLength = 0;
let symbolTable = {};
let variableAddresses = {};
let currentTab = 'assembly';
let assembledOnce = false;

// â”€â”€ Questions State â”€â”€
let questions = [];
let score = 0;
let answered = 0;

// â”€â”€ Initialize â”€â”€
function init() {
  buildMemoryGrid();
  updateRegistersDisplay();
  updateMemoryDisplay();
  setupKeyboardShortcuts();
  document.getElementById('speed-slider').addEventListener('input', updateSpeedLabel);
  updateSpeedLabel();
}

function buildMemoryGrid() {
  const grid = document.getElementById('memory-grid');
  grid.innerHTML = '';
  for (let i = 0; i < 100; i++) {
    const cell = document.createElement('div');
    cell.className = 'mem-cell';
    cell.id = `mem-${i}`;
    cell.innerHTML = `<span class="mem-addr">${String(i).padStart(2,'0')}</span><span class="mem-val" id="memval-${i}">0</span>`;
    cell.addEventListener('mouseenter', (e) => showTooltip(e, i));
    cell.addEventListener('mouseleave', hideTooltip);
    grid.appendChild(cell);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ASSEMBLER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function assembleAndLoad() {
  hideError();
  const code = document.getElementById('code-editor').value.trim();
  if (!code) return showError('No code to assemble');

  if (currentTab === 'machine') {
    loadMachineCode(code);
    return;
  }

  try {
    const result = assemble(code);
    resetState();
    for (let i = 0; i < result.instructions.length; i++) {
      memory[i] = result.instructions[i];
    }
    memory[98] = 0;
    memory[99] = 1;
    programLength = result.instructions.length;
    symbolTable = result.symbols;
    variableAddresses = result.variables;
    assembledOnce = true;

    // Load input
    const inputStr = document.getElementById('input-field').value.trim();
    if (inputStr) {
      inputQueue = inputStr.split(',').map(s => {
        const n = parseInt(s.trim());
        if (isNaN(n)) throw new Error(`Invalid input: "${s.trim()}"`);
        if (n < -999 || n > 999) throw new Error(`Input out of range: ${n}`);
        return n;
      });
    }

    updateAll();
    setStatus('ready', 'LOADED');
  } catch (e) {
    showError(e.message);
  }
}

function assemble(code) {
  const lines = code.split('\n');
  const symbols = {};      // label -> address
  const variables = {};     // variable name -> address
  const instructions = [];
  const unresolvedLabels = []; // {index, label, type}

  // Pre-defined
  variables['zero'] = 98;
  variables['one'] = 99;

  let nextVarAddr = 97; // allocate variables from 97 downward

  // Pass 1: Collect labels and parse instructions
  const parsedLines = [];
  let instrAddr = 0;

  for (let lineNum = 0; lineNum < lines.length; lineNum++) {
    let line = lines[lineNum].trim();

    // Remove comments
    const commentIdx = line.indexOf('//');
    if (commentIdx !== -1) line = line.substring(0, commentIdx).trim();
    if (!line) continue;

    // Check for label definition
    if (line.endsWith(':')) {
      const label = line.slice(0, -1).trim();
      if (!label) throw new Error(`Empty label at line ${lineNum + 1}`);
      symbols[label] = instrAddr;
      continue;
    }

    // Check for label on same line as instruction (LABEL: instruction)
    const colonIdx = line.indexOf(':');
    if (colonIdx !== -1) {
      const possibleLabel = line.substring(0, colonIdx).trim();
      const rest = line.substring(colonIdx + 1).trim();
      if (possibleLabel && !possibleLabel.includes(' ')) {
        symbols[possibleLabel] = instrAddr;
        line = rest;
        if (!line) continue;
      }
    }

    parsedLines.push({ line, addr: instrAddr, lineNum: lineNum + 1 });
    instrAddr++;
  }

  // Pass 2: Generate machine code
  for (const { line, addr, lineNum } of parsedLines) {
    const parts = line.split(/\s+/);
    const cmd = parts[0].toLowerCase();
    const operand = parts.length > 1 ? parts[1] : null;

    if (!(cmd in OPCODES)) {
      throw new Error(`Unknown command "${cmd}" at line ${lineNum}`);
    }

    const opcode = OPCODES[cmd];

    if (cmd === 'stop') {
      instructions.push(0);
    } else if (NO_OPERAND.has(cmd)) {
      instructions.push(opcode * 100);
    } else {
      if (!operand) throw new Error(`"${cmd}" requires an operand at line ${lineNum}`);

      let address;

      // Is it a direct number/address?
      if (/^\d+$/.test(operand)) {
        address = parseInt(operand);
      }
      // Is it a label (goto/gotoz/gotop)?
      else if (['goto', 'gotoz', 'gotop'].includes(cmd)) {
        if (operand in symbols) {
          address = symbols[operand];
        } else {
          // Forward reference - resolve later
          instructions.push({ opcode, label: operand, lineNum });
          continue;
        }
      }
      // It's a variable name
      else {
        const varName = operand.toLowerCase();
        if (varName in variables) {
          address = variables[varName];
        } else {
          // Allocate new variable
          if (nextVarAddr < instrAddr) {
            throw new Error(`Out of variable space at line ${lineNum}`);
          }
          variables[varName] = nextVarAddr;
          address = nextVarAddr;
          nextVarAddr--;
        }
      }

      if (address < 0 || address > 99) {
        throw new Error(`Address ${address} out of range at line ${lineNum}`);
      }
      instructions.push(opcode * 100 + address);
    }
  }

  // Resolve forward references
  for (let i = 0; i < instructions.length; i++) {
    const instr = instructions[i];
    if (typeof instr === 'object') {
      if (instr.label in symbols) {
        instructions[i] = instr.opcode * 100 + symbols[instr.label];
      } else {
        throw new Error(`Undefined label "${instr.label}" at line ${instr.lineNum}`);
      }
    }
  }

  return { instructions, symbols, variables };
}

function loadMachineCode(code) {
  const lines = code.split('\n');
  resetState();

  let addr = 0;
  for (const line of lines) {
    const trimmed = line.trim();
    if (!trimmed || trimmed.startsWith('//')) continue;

    // Support "addr: value" or just "value"
    let val;
    if (trimmed.includes(':')) {
      const parts = trimmed.split(':');
      addr = parseInt(parts[0].trim());
      val = parseInt(parts[1].trim());
    } else {
      val = parseInt(trimmed);
    }

    if (isNaN(val)) continue;
    if (addr < 0 || addr > 99) { showError(`Address ${addr} out of range`); return; }
    memory[addr] = val;
    addr++;
  }

  memory[98] = 0;
  memory[99] = 1;
  programLength = addr;
  assembledOnce = true;

  const inputStr = document.getElementById('input-field').value.trim();
  if (inputStr) {
    inputQueue = inputStr.split(',').map(s => parseInt(s.trim())).filter(n => !isNaN(n));
  }

  updateAll();
  setStatus('ready', 'LOADED');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// EXECUTION ENGINE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function stepExecution() {
  if (halted) return;
  if (!assembledOnce) { assembleAndLoad(); return; }
  savePrevMemory();
  executeOneStep();
  updateAll();
}

function executeOneStep() {
  if (halted || waitingForInput) return;

  if (pc < 0 || pc > 99) {
    halt('Program counter out of bounds: ' + pc);
    return;
  }

  const instruction = memory[pc];
  ir = instruction;

  const opcode = Math.floor(Math.abs(instruction) / 100);
  const operand = Math.abs(instruction) % 100;

  pc++;

  switch (opcode) {
    case 0: // stop
      halt('Program terminated by Stop command');
      break;

    case 1: // read
      if (inputQueue.length > 0) {
        dr = inputQueue.shift();
        updateInputDisplay();
      } else {
        pc--; // stay at this instruction
        waitingForInput = true;
        showInputPrompt();
        if (running) pauseExecution();
        setStatus('input', 'WAITING INPUT');
      }
      break;

    case 2: // write
      outputValues.push(dr);
      break;

    case 3: // load
      dr = memory[operand];
      break;

    case 4: // store
      memory[operand] = dr;
      break;

    case 5: // add
      dr = dr + memory[operand];
      if (dr > 999) dr = 999;
      if (dr < -999) dr = -999;
      break;

    case 6: // sub
      dr = dr - memory[operand];
      if (dr > 999) dr = 999;
      if (dr < -999) dr = -999;
      break;

    case 7: // goto
      pc = operand;
      break;

    case 8: // gotoz
      if (dr === 0) pc = operand;
      break;

    case 9: // gotop
      if (dr > 0) pc = operand;
      break;

    default:
      halt('Unknown opcode: ' + opcode);
  }
}

function runExecution() {
  if (halted) return;
  if (!assembledOnce) { assembleAndLoad(); }

  running = true;
  setStatus('running', 'RUNNING');

  const speed = getSpeed();
  runInterval = setInterval(() => {
    if (halted || waitingForInput) {
      pauseExecution();
      return;
    }
    savePrevMemory();
    executeOneStep();
    updateAll();
  }, speed);
}

function pauseExecution() {
  running = false;
  if (runInterval) { clearInterval(runInterval); runInterval = null; }
  if (!halted && !waitingForInput) setStatus('ready', 'PAUSED');
}

function halt(message) {
  halted = true;
  running = false;
  if (runInterval) { clearInterval(runInterval); runInterval = null; }
  setStatus('halted', 'HALTED');
}

function resetState() {
  memory.fill(0);
  prevMemory.fill(0);
  pc = 0; ir = null; dr = 0;
  inputQueue = [];
  outputValues = [];
  running = false; halted = false; waitingForInput = false;
  if (runInterval) { clearInterval(runInterval); runInterval = null; }
  programLength = 0;
  symbolTable = {};
  variableAddresses = {};
}

function resetSimulator() {
  resetState();
  assembledOnce = false;
  document.getElementById('output-display').innerHTML = '';
  hideError();
  hideInputPrompt();
  updateAll();
  setStatus('ready', 'READY');
}

function savePrevMemory() {
  prevMemory = [...memory];
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UI UPDATES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function updateAll() {
  updateRegistersDisplay();
  updateMemoryDisplay();
  updateOutputDisplay();
}

function updateRegistersDisplay() {
  document.getElementById('reg-pc').textContent = String(pc).padStart(2, '0');
  document.getElementById('reg-dr').textContent = dr;

  if (ir !== null) {
    document.getElementById('reg-ir').textContent = ir;
    const opcode = Math.floor(Math.abs(ir) / 100);
    const operand = Math.abs(ir) % 100;
    const name = OPCODE_NAMES[opcode] || '???';
    const decoded = NO_OPERAND.has(name) ? name : `${name} [${String(operand).padStart(2,'0')}]`;
    document.getElementById('ir-decoded').textContent = decoded;
  } else {
    document.getElementById('reg-ir').textContent = '---';
    document.getElementById('ir-decoded').innerHTML = '&nbsp;';
  }
}

function updateMemoryDisplay() {
  for (let i = 0; i < 100; i++) {
    const cell = document.getElementById(`mem-${i}`);
    const valEl = document.getElementById(`memval-${i}`);
    valEl.textContent = memory[i];

    cell.className = 'mem-cell';
    if (i === pc && !halted) cell.classList.add('is-pc');
    if (memory[i] !== prevMemory[i]) cell.classList.add('is-changed');
    if (i < programLength && memory[i] !== 0) cell.classList.add('has-instruction');
    if (i === 98) cell.classList.add('is-zero');
    if (i === 99) cell.classList.add('is-one');

    // Check if it's a known variable address
    for (const [name, addr] of Object.entries(variableAddresses)) {
      if (addr === i && addr !== 98 && addr !== 99 && i >= programLength) {
        cell.classList.add('is-data');
      }
    }
  }
}

function updateOutputDisplay() {
  const el = document.getElementById('output-display');
  el.innerHTML = outputValues.map(v => `<span class="output-val">${v}</span>`).join('');
}

function updateInputDisplay() {
  // Show remaining input
  const el = document.getElementById('input-field');
  // Don't modify - keep original for reference
}

function setStatus(type, text) {
  const el = document.getElementById('status-display');
  el.className = 'status-indicator';
  el.classList.add(`status-${type}`);
  el.textContent = text;
}

function showError(msg) {
  const el = document.getElementById('error-bar');
  el.textContent = 'âš  ' + msg;
  el.classList.add('show');
}

function hideError() {
  document.getElementById('error-bar').classList.remove('show');
}

function showInputPrompt() {
  document.getElementById('input-prompt').classList.add('active');
  setTimeout(() => document.getElementById('runtime-input').focus(), 100);
}

function hideInputPrompt() {
  document.getElementById('input-prompt').classList.remove('active');
}

function submitRuntimeInput() {
  const input = document.getElementById('runtime-input');
  const val = parseInt(input.value);
  if (isNaN(val)) return;
  if (val < -999 || val > 999) { alert('Value must be between -999 and 999'); return; }

  dr = val;
  pc++; // move past the read instruction
  waitingForInput = false;
  input.value = '';
  hideInputPrompt();
  updateAll();
  setStatus('ready', 'READY');
}

document.getElementById('runtime-input').addEventListener('keydown', (e) => {
  if (e.key === 'Enter') submitRuntimeInput();
});

function showTooltip(e, addr) {
  const tooltip = document.getElementById('mem-tooltip');
  const val = memory[addr];
  const opcode = Math.floor(Math.abs(val) / 100);
  const operand = Math.abs(val) % 100;

  let info = `Cell ${String(addr).padStart(2,'0')}: ${val}`;

  // Check if it's a variable
  for (const [name, a] of Object.entries(variableAddresses)) {
    if (a === addr) info += `\n(${name})`;
  }

  // Decode if instruction
  if (addr < programLength && val !== 0) {
    const name = OPCODE_NAMES[opcode];
    if (name) {
      info += `\nâ†’ ${name}`;
      if (!NO_OPERAND.has(name)) info += ` ${String(operand).padStart(2,'0')}`;
    }
  }

  tooltip.textContent = info;
  tooltip.style.display = 'block';
  tooltip.style.left = (e.clientX + 12) + 'px';
  tooltip.style.top = (e.clientY - 10) + 'px';
}

function hideTooltip() {
  document.getElementById('mem-tooltip').style.display = 'none';
}

function getSpeed() {
  const val = document.getElementById('speed-slider').value;
  return Math.max(5, 1010 - val * 10);
}

function updateSpeedLabel() {
  const val = document.getElementById('speed-slider').value;
  const ms = Math.max(5, 1010 - val * 10);
  document.getElementById('speed-label').textContent = ms + 'ms';
}

function switchTab(tab) {
  currentTab = tab;
  document.getElementById('tab-assembly').classList.toggle('active', tab === 'assembly');
  document.getElementById('tab-machine').classList.toggle('active', tab === 'machine');

  const editor = document.getElementById('code-editor');
  if (tab === 'machine') {
    editor.placeholder = '// Enter machine code\n// One instruction per line\n// Or addr: value format\n100\n496\n100\n...\n\n// Or:\n00: 100\n01: 496';
  } else {
    editor.placeholder = '// Write VIC assembly here\nread\nstore x\n...';
  }
}

function toggleExamples() {
  document.getElementById('examples-menu').classList.toggle('show');
}

document.addEventListener('click', (e) => {
  if (!e.target.closest('.examples-dropdown')) {
    document.getElementById('examples-menu').classList.remove('show');
  }
});

function setupKeyboardShortcuts() {
  document.addEventListener('keydown', (e) => {
    if (e.ctrlKey && e.key === 'Enter') { e.preventDefault(); assembleAndLoad(); }
    if (e.key === 'F5') { e.preventDefault(); runExecution(); }
    if (e.key === 'F10') { e.preventDefault(); stepExecution(); }
    if (e.key === 'Escape') { pauseExecution(); }
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// EXAMPLE PROGRAMS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const EXAMPLES = {
  modulo: {
    code: `// Modulo: computes a % b
// Input: a, b  Output: a mod b
read
store dividend
read
store divisor
LOOP:
  load dividend
  sub divisor
  store dividend
  gotop LOOP
  gotoz DONE
  // D < 0, add back divisor
  add divisor
  write
  stop
DONE:
  load zero
  write
  stop`,
    input: '15, 4'
  },
  multiply: {
    code: `// Multiply: computes a Ã— b
// Input: a, b  Output: a * b
read
store a
read
store counter
load zero
store result
LOOP:
  load counter
  gotoz DONE
  load result
  add a
  store result
  load counter
  sub one
  store counter
  goto LOOP
DONE:
  load result
  write
  stop`,
    input: '6, 7'
  },
  abs: {
    code: `// Absolute Value
// Input: number  Output: |number|
read
gotop POSITIVE
gotoz IS_ZERO
// negative: negate by subtracting from 0
store temp
load zero
sub temp
write
stop
POSITIVE:
  write
  stop
IS_ZERO:
  write
  stop`,
    input: '-42'
  },
  max: {
    code: `// Maximum of two numbers
// Input: a, b  Output: max(a, b)
read
store a
read
store b
load a
sub b
gotop A_WINS
// b >= a
load b
write
stop
A_WINS:
  load a
  write
  stop`,
    input: '23, 47'
  },
  countdown: {
    code: `// Countdown from n to 0
// Input: n  Output: n, n-1, ..., 1, 0
read
store n
LOOP:
  load n
  write
  gotoz DONE
  sub one
  store n
  goto LOOP
DONE:
  stop`,
    input: '5'
  },
  sum: {
    code: `// Sum numbers until 0
// Input: numbers ending with 0
// Output: sum
load zero
store total
LOOP:
  read
  gotoz DONE
  store current
  load total
  add current
  store total
  goto LOOP
DONE:
  load total
  write
  stop`,
    input: '10, 20, 30, 0'
  },
  divide: {
    code: `// Integer Division: a / b
// Input: a, b  Output: quotient
read
store dividend
read
store divisor
load zero
store quotient
LOOP:
  load dividend
  sub divisor
  gotop CONTINUE
  gotoz ADD_ONE
  // D < 0, done
  load quotient
  write
  stop
ADD_ONE:
  load quotient
  add one
  write
  stop
CONTINUE:
  store dividend
  load quotient
  add one
  store quotient
  goto LOOP`,
    input: '20, 4'
  },
  fibonacci: {
    code: `// Fibonacci: print first n terms
// Input: n  Output: fib sequence
read
store count
load zero
store prev
write
load one
store curr
load count
sub one
store count
LOOP:
  load count
  gotoz DONE
  load curr
  write
  store temp
  add prev
  store curr
  load temp
  store prev
  load count
  sub one
  store count
  goto LOOP
DONE:
  stop`,
    input: '8'
  }
};

function loadExample(name) {
  const ex = EXAMPLES[name];
  if (!ex) return;
  document.getElementById('code-editor').value = ex.code;
  document.getElementById('input-field').value = ex.input;
  switchTab('assembly');
  document.getElementById('examples-menu').classList.remove('show');
  resetSimulator();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// QUESTIONS SYSTEM
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/**
 * Load questions into the sidebar.
 * 
 * Format: Array of question objects
 * 
 * Multiple choice:
 * {
 *   type: 'multiple-choice',
 *   question: 'What does the read command do?',
 *   options: ['D = input', 'output = D', 'D = 0', 'stop'],
 *   correct: 0,  // index of correct option
 *   explanation: 'read takes input and stores it in D'
 * }
 * 
 * Free text:
 * {
 *   type: 'free-text',
 *   question: 'What is the output for input 15, 4?',
 *   correct: '3',  // string to match
 *   explanation: '15 mod 4 = 3'
 * }
 * 
 * Code/program questions:
 * {
 *   type: 'multiple-choice',
 *   question: 'What does this program output?\n```\nread\nadd one\nwrite\nstop\n```\nInput: 5',
 *   options: ['5', '6', '4', '1'],
 *   correct: 1,
 *   explanation: 'read gets 5, add one makes D=6, write outputs 6'
 * }
 */
function loadQuestions(questionData) {
  questions = questionData;
  score = 0;
  answered = 0;
  renderQuestions();
}

function renderQuestions() {
  const container = document.getElementById('questions-container');
  
  if (!questions.length) {
    container.innerHTML = `<div class="no-questions">
      <div class="icon">ğŸ“‹</div>
      <div>No questions loaded yet.</div>
    </div>`;
    return;
  }

  container.innerHTML = questions.map((q, i) => {
    const qHtml = formatQuestionText(q.question);
    
    if (q.type === 'multiple-choice') {
      return `<div class="question-card" id="qcard-${i}">
        <div class="q-number">QUESTION ${i + 1}</div>
        <div class="q-text">${qHtml}</div>
        <div class="q-options">
          ${q.options.map((opt, j) => 
            `<div class="q-option" id="qopt-${i}-${j}" onclick="selectOption(${i}, ${j})">${opt}</div>`
          ).join('')}
        </div>
        <button class="q-check-btn" onclick="checkAnswer(${i})">CHECK ANSWER</button>
        <div class="q-feedback" id="qfeedback-${i}"></div>
      </div>`;
    } else {
      return `<div class="question-card" id="qcard-${i}">
        <div class="q-number">QUESTION ${i + 1}</div>
        <div class="q-text">${qHtml}</div>
        <input type="text" class="q-input-answer" id="qinput-${i}" placeholder="Type your answer...">
        <button class="q-check-btn" onclick="checkAnswer(${i})">CHECK ANSWER</button>
        <div class="q-feedback" id="qfeedback-${i}"></div>
      </div>`;
    }
  }).join('');

  updateScore();
}

function formatQuestionText(text) {
  // Convert markdown-like code blocks
  text = text.replace(/```([\s\S]*?)```/g, '<pre>$1</pre>');
  text = text.replace(/`([^`]+)`/g, '<code>$1</code>');
  text = text.replace(/\n/g, '<br>');
  return text;
}

function selectOption(qIdx, optIdx) {
  const q = questions[qIdx];
  if (q._answered) return;

  // Deselect all
  q.options.forEach((_, j) => {
    document.getElementById(`qopt-${qIdx}-${j}`).classList.remove('selected');
  });
  document.getElementById(`qopt-${qIdx}-${optIdx}`).classList.add('selected');
  q._selected = optIdx;
}

function checkAnswer(qIdx) {
  const q = questions[qIdx];
  if (q._answered) return;

  const feedback = document.getElementById(`qfeedback-${qIdx}`);
  const card = document.getElementById(`qcard-${qIdx}`);
  let isCorrect = false;

  if (q.type === 'multiple-choice') {
    if (q._selected === undefined) return;
    isCorrect = q._selected === q.correct;

    // Highlight correct/wrong
    q.options.forEach((_, j) => {
      const el = document.getElementById(`qopt-${qIdx}-${j}`);
      if (j === q.correct) el.classList.add('correct-answer');
      else if (j === q._selected && !isCorrect) el.classList.add('wrong-answer');
    });
  } else {
    const input = document.getElementById(`qinput-${qIdx}`);
    const userAnswer = input.value.trim();
    if (!userAnswer) return;
    isCorrect = userAnswer.toLowerCase() === String(q.correct).toLowerCase();
    input.disabled = true;
  }

  q._answered = true;
  answered++;
  if (isCorrect) score++;

  feedback.className = 'q-feedback show ' + (isCorrect ? 'correct' : 'incorrect');
  feedback.textContent = isCorrect
    ? 'âœ“ Correct! ' + (q.explanation || '')
    : 'âœ— Incorrect. ' + (q.explanation || '');

  card.classList.add(isCorrect ? 'correct' : 'incorrect');
  updateScore();
}

function updateScore() {
  const el = document.getElementById('score-display');
  if (questions.length > 0) {
    el.textContent = `${score}/${answered} (${questions.length} total)`;
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

init();

// Demo: load modulo example on start
loadExample('modulo');
</script>
</body>
</html>
